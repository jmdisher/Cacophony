<!DOCTYPE html>
<html lang="en" ng-app="App">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>

<script src="./generated_db.js" type="text/javascript"></script>
<script type="text/javascript">
function GET(path)
{
	return fetch("http://127.0.0.1:8000" + path, {
		method: "GET",
	});
}

function POST(path)
{
	return fetch("http://127.0.0.1:8000" + path, {
		method: "POST",
	});
}

function DELETE(path)
{
	return fetch("http://127.0.0.1:8000" + path, {
		method: "DELETE",
	});
}

function stopServer()
{
	POST("/stop")
		.then(data => data.text())
		.then(text => console.log(text));
}


// We will create an Angular controller and populate it with data from generated_db.js.
var GLOBAL_Application = angular.module('App', []);
GLOBAL_Application.controller('AppController', function($scope)
{
	$scope.drafts = null;
	$scope.selectedDraft = null;
	$scope.inProgress = false;
	
	$scope.selectDraft = function(draft)
	{
		$scope.selectedDraft = draft;
	}
	$scope.createNewDraft = function()
	{
		POST("/createDraft")
			.then(data => data.json())
			.then(draftObject => {
				$scope.drafts.push(draftObject);
				$scope.selectedDraft = draftObject;
				$scope.$apply();
			});
	}
	$scope.deleteDraft = function(draft)
	{
		DELETE("/draft/" + draft.id)
			.then(data => {
				if ((null !== $scope.selectedDraft) && ($scope.selectedDraft.id === draft.id))
				{
					$scope.selectedDraft = null;
				}
				$scope.drafts = $scope.drafts.filter((element, index, array) => {
					return (element.id !== draft.id);
				});
				$scope.$apply();
			});
	}
	
	GET("/drafts")
		.then(data => data.json())
		.then(json => {
			$scope.drafts = json;
			$scope.$apply();
		});
});

</script>

	<title>Cacophony - Static Index</title>
	<meta charset="utf-8"></meta>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"></link>
</head>
<body ng-controller="AppController">
<nav class="navbar navbar-inverse">
	<ul class="nav navbar-nav">
		<li><a class="navbar-link" href="index.html">Index</a></li>
		<li><a class="navbar-link" href="prefs.html">Preferences</a></li>
		<li><a class="navbar-link" href="user.html">This User</a></li>
		<li><a class="navbar-link" href="recommending.html">Recommended Users</a></li>
		<li><a class="navbar-link" href="following.html">Users you Follow</a></li>
	</ul>
</nav>
<div class="container">
	<div class="row">
		<div class="well col-md-3">
			<div class="row"><a class="btn" href="index.html">Index</a></div>
			<div class="row"><a class="btn" href="prefs.html">Preferences</a></div>
			<div class="row"><a class="btn" href="user.html">This User</a></div>
			<div class="row"><a class="btn" href="recommending.html">Recommended Users</a></div>
			<div class="row"><a class="btn" href="following.html">Users you Follow</a></div>
		</div>
		<div class="well col-md-6">
			<em ng-show="null == drafts">Loading drafts...</em>
			<div class="row" ng-show="null != drafts">Drafts ({{drafts.length}}):<br />
				<ul>
					<li ng-repeat="draft in drafts"><button class="btn btn-sm btn-danger" ng-click="deleteDraft(draft)">Delete</button> <a ng-click="selectDraft(draft)">{{draft.title}}</a></li>
				</ul>
			</div>
		</div>
		<div class="well col-md-3">
			<button class="btn btn-danger" onClick="stopServer()">STOP SERVER</button><br/>
			<button class="btn btn-small btn-success" ng-click="createNewDraft()" ng-disabled="inProgress">New Draft</button><br />
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<div class="well" ng-show="null == selectedDraft">
				Select a draft to see details.
			</div>
			<div class="well" ng-show="null != selectedDraft">
				Draft:  <strong>{{selectedDraft.title}}</strong>.<br />
			</div>
		</div>
	</div>
</div>
</body>
</html>

